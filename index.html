<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Specialist | Elite Strategic Suite</title>
    <!-- Core Engine Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --gold: #D4AF37;
            --gold-bright: #FACC15;
            --dark-bg: #000000;
            --zinc-bright: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--zinc-bright);
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .luxury-font { font-family: 'Playfair Display', serif; }

        /* Neural Preloader */
        #neural-preloader {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        .loader-ring {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(250, 204, 21, 0.1);
            border-top: 3px solid var(--gold-bright);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .glass-card {
            background: rgba(18, 18, 18, 0.98);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(250, 204, 21, 0.3);
            border-radius: 1rem;
        }

        .gold-gradient {
            background: linear-gradient(135deg, #FFF7AD 0%, #FACC15 50%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .neural-btn {
            background: linear-gradient(135deg, #FACC15 0%, #D4AF37 100%);
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            color: #000;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-weight: 900;
        }

        .neural-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.4);
        }

        .nav-item.active {
            background: linear-gradient(to right, rgba(250, 204, 21, 0.2), transparent);
            border-left: 4px solid var(--gold-bright);
            color: var(--gold-bright);
        }

        .nav-item:hover:not(.active) {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Result Area Optimized */
        .prose { 
            max-width: 100%; 
            font-size: 1.05rem; 
            line-height: 1.8; 
            color: #ffffff; 
            text-align: justify; 
            text-justify: inter-word;
        }
        .prose h1, .prose h2, .prose h3 { 
            font-family: 'Playfair Display', serif; 
            color: var(--gold-bright); 
            margin-top: 2rem; 
            font-weight: 800; 
            text-align: left; 
        }
        .prose table { border: 1px solid #444; width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: rgba(15, 15, 15, 0.5); }
        .prose th { background: #222; color: var(--gold-bright); padding: 0.8rem; text-align: left; border: 1px solid #444; }
        .prose td { border: 1px solid #444; padding: 0.8rem; color: #ffffff; }
        .prose strong { color: #FACC15; font-weight: 800; }
        .prose ul, .prose ol { padding-left: 1.5rem; margin-bottom: 1.25rem; }
        .prose li { margin-bottom: 0.5rem; }

        input, textarea, select {
            color: #ffffff !important;
            background-color: #0a0a0a !important;
            border: 1px solid #333 !important;
            outline: none;
            width: 100%;
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--gold-bright) !important;
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--gold-bright); border-radius: 10px; }

        .hidden-element { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .scroll-zone {
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        select option { background-color: #000; color: #fff; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Neural Preloader -->
    <div id="neural-preloader">
        <div class="loader-ring mb-6"></div>
        <p class="luxury-font text-xl gold-gradient italic font-bold">Social Media Specialist</p>
        <p class="text-[8px] text-zinc-500 tracking-[0.5em] uppercase mt-2">Aegis Core Memory Locked</p>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-6 bg-black relative overflow-hidden hidden-element">
        <div class="absolute top-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-500/5 blur-[120px] rounded-full"></div>
        <div class="glass-card p-10 w-full max-w-md z-10 border-amber-500/20 shadow-2xl text-white text-center">
            <h1 class="luxury-font text-3xl font-bold gold-gradient italic mb-2">Social Specialist</h1>
            <p class="text-zinc-400 text-xs uppercase tracking-[0.4em] font-bold mb-10">Akses CEO Terotorisasi</p>

            <form id="login-form" class="space-y-6 text-left">
                <div>
                    <label class="block text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-2 text-white">Email Address</label>
                    <input type="email" id="login-email" required class="px-5 py-4 rounded-lg" placeholder="ceo@elite.com">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-zinc-400 uppercase tracking-widest mb-2 text-white">Password</label>
                    <input type="password" id="login-password" required class="px-5 py-4 rounded-lg" placeholder="••••••••">
                </div>
                <button type="submit" id="btn-login-submit" class="neural-btn w-full py-4 rounded-lg mt-4 font-black">Otorisasi Masuk</button>
            </form>
            <p id="login-error" class="text-red-500 text-xs mt-6 italic hidden-element text-center"></p>
        </div>
    </div>

    <!-- API Gate -->
    <div id="api-activation-screen" class="min-h-screen flex items-center justify-center p-6 bg-black relative overflow-hidden hidden-element fade-in">
        <div class="glass-card p-10 w-full max-w-2xl z-10 border-amber-500/20 shadow-2xl">
            <h2 class="luxury-font text-3xl text-white font-bold mb-2 italic text-center">Aktivasi Neural</h2>
            <p class="text-zinc-400 text-sm text-center mb-8">Input Google AI Studio API Key untuk memulai strategi elite.</p>

            <div class="space-y-6">
                <div class="relative">
                    <label class="block text-[10px] font-bold text-white uppercase tracking-widest mb-3">Google AI Studio Key</label>
                    <input type="password" id="input-api-key" class="px-5 py-5 rounded-xl font-mono tracking-widest" placeholder="AIzaSy...">
                    <button onclick="window.toggleTutorial()" class="absolute right-4 top-[42px] text-[10px] text-amber-500 border border-amber-500/30 px-3 py-1 rounded-full hover:bg-amber-500/10 transition-all font-bold uppercase">Tutorial</button>
                </div>

                <div id="api-tutorial" class="hidden-element p-6 bg-zinc-950 border border-zinc-800 rounded-xl">
                    <h3 class="luxury-font text-amber-400 text-lg mb-3">Langkah Cepat:</h3>
                    <ol class="text-zinc-300 text-sm space-y-2 list-decimal pl-5">
                        <li>Buka <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-amber-500 underline">Google AI Studio</a>.</li>
                        <li>Salin API Key yang tersedia.</li>
                        <li>Tempel pada kolom di atas.</li>
                    </ol>
                </div>

                <button onclick="window.validateApiKey()" id="btn-validate-key" class="neural-btn w-full py-5 rounded-xl font-black text-sm uppercase tracking-widest">Aktifkan Intelligence Suite</button>
                <div class="text-center pt-2"><button onclick="window.handleLogout()" class="text-zinc-600 hover:text-zinc-400 text-[10px] uppercase font-bold">Logout</button></div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="main-wrapper" class="min-h-screen flex flex-col md:flex-row overflow-hidden hidden-element fade-in">
        <aside class="w-full md:w-64 border-r border-zinc-800 bg-black flex-shrink-0 z-30 flex flex-col h-screen sticky top-0">
            <div class="p-8 text-center border-b border-zinc-900">
                <h1 class="luxury-font text-2xl font-bold gold-gradient italic tracking-tighter">Social Specialist</h1>
                <p class="text-[8px] text-zinc-500 tracking-[0.4em] uppercase mt-2 font-black">Professional Elite Hub</p>
            </div>
            
            <nav class="flex-1 px-3 pb-10 overflow-y-auto" id="sidebar-nav"></nav>

            <div class="p-5 border-t border-zinc-900 space-y-3">
                <button onclick="window.clearApiKey()" class="w-full py-3 rounded-lg border border-red-900/30 text-red-500/70 text-[9px] font-bold uppercase hover:bg-red-500/10 transition-all flex items-center justify-center gap-2"><i data-lucide="trash-2" class="w-3 h-3"></i> Hapus API Key</button>
                <button onclick="window.handleLogout()" class="w-full py-3 rounded-lg text-zinc-600 text-[9px] font-bold uppercase hover:text-white transition-colors">Terminate Session</button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative h-screen bg-black">
            <header class="h-20 border-b border-zinc-800 flex items-center justify-between px-8 md:px-12 backdrop-blur-3xl sticky top-0 z-20">
                <div class="flex items-center gap-4">
                    <div class="w-2 h-2 bg-amber-400 rounded-full animate-pulse shadow-[0_0_10px_#facc15]"></div>
                    <div>
                        <h2 id="active-tool-title" class="luxury-font text-lg md:text-xl font-bold text-white tracking-tight italic">Dashboard</h2>
                        <p id="active-tool-desc" class="text-[9px] text-zinc-400 uppercase tracking-widest font-bold">Neural Engine v2026.4</p>
                    </div>
                </div>
                <div class="h-10 w-10 rounded-full border border-zinc-800 flex items-center justify-center bg-zinc-950"><i data-lucide="cpu" class="w-4 h-4 text-amber-500"></i></div>
            </header>

            <div class="flex-1 scroll-zone p-4 md:p-12" id="main-scroll-area">
                <div class="max-w-4xl mx-auto pb-20">
                    <div id="tool-interface" class="glass-card p-6 md:p-12 shadow-2xl"></div>
                    <div id="result-container" class="mt-12 hidden-element fade-in">
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                            <div class="flex items-center gap-3">
                                <div class="h-8 w-1 bg-amber-400 rounded-full"></div>
                                <h3 class="luxury-font text-2xl text-white font-bold italic">Hasil Analisa Elit</h3>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="window.exportToWord()" class="px-5 py-2.5 rounded-full border border-amber-500/40 bg-amber-500/10 hover:bg-amber-500/20 text-amber-400 text-[10px] font-black uppercase"><i data-lucide="file-text" class="w-3.5 h-3.5"></i> Simpan Word</button>
                                <button onclick="window.copyResult()" class="px-5 py-2.5 rounded-full border border-zinc-700 bg-zinc-900 hover:bg-zinc-800 text-zinc-100 text-[10px] font-black uppercase"><i data-lucide="copy" class="w-3.5 h-3.5"></i> Salin Teks</button>
                            </div>
                        </div>
                        <div id="result-content" class="glass-card p-8 md:p-12 prose max-w-none border-t-4 border-amber-400/50 shadow-inner"></div>
                    </div>
                </div>
            </div>

            <div id="notification" class="fixed bottom-10 right-10 glass-card px-8 py-4 transform translate-y-40 opacity-0 transition-all duration-700 border-amber-400 shadow-2xl flex items-center gap-4 z-50">
                <div id="notif-icon-box" class="p-2 bg-amber-400/20 rounded-full"><i data-lucide="shield-check" class="w-4 h-4 text-amber-400"></i></div>
                <span id="notification-text" class="text-[10px] font-bold uppercase tracking-widest text-white"></span>
            </div>
        </main>
    </div>

    <!-- Logic Hub -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCEpU2xyc75-hSVYsePPAf3C79TWdNctyQ",
            authDomain: "sosmedsp-6f8d8.firebaseapp.com",
            projectId: "sosmedsp-6f8d8",
            storageBucket: "sosmedsp-6f8d8.firebasestorage.app",
            messagingSenderId: "184660680582",
            appId: "1:184660680582:web:27cfe89fffa2748ebbd607"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const systemId = "sosmed-specialist-elite-final-v4";

        window.geminiApiKey = "";
        let isLoadingAI = false;

        // FIXED 14 ELITE MODULES - NO LOSS COMMITMENT
        const toolCategories = [
            {
                name: "Strategic Brain",
                tools: [
                    {
                        id: 'neural-planner', icon: 'cpu', name: 'Neural Campaign',
                        desc: 'Rancang ekosistem konten 30 hari dalam sekali eksekusi cerdas.',
                        inputs: [
                            { id: 'brand_n', label: 'Identitas Brand', placeholder: 'e.g. Toko Kue Premium atau Skincare Viral' },
                            { id: 'goal_n', label: 'Tujuan Strategis', type: 'select', options: [
                                'Pertumbuhan Viral & Jangkauan Masif', 'Funnel Penjualan Konversi Tinggi', 'Membangun Komunitas Fanatik',
                                'Otoritas Ahli & Kepemimpinan Opini', 'Kesadaran Merek & Dominasi Pasar', 'Pencarian Database Calon Pembeli',
                                'Momentum Peluncuran Produk Baru', 'Fokus Loyalitas & Retensi Pelanggan', 'Akuisisi Klien Mewah (High-Ticket)'
                            ]}
                        ],
                        prompt: (data) => `Buat strategi kampanye 30 hari untuk "${data.brand_n}" dengan goal "${data.goal_n}". Berikan solusi 'Super Daging'.`
                    },
                    {
                        id: 'shadow-audit', icon: 'eye', name: 'Shadow Auditor',
                        desc: 'Deteksi kelemahan kompetitor dan celah algoritma secara brutal.',
                        inputs: [{ id: 'comp_data', label: 'Konteks Kompetitor', type: 'textarea', placeholder: 'e.g. Akun @pesaing sering posting tips tapi interaksi sepi...' }],
                        prompt: (data) => `Analisa kompetitor: "${data.comp_data}". Temukan 3 celah fatal.`
                    }
                ]
            },
            {
                name: "Elite Creation",
                tools: [
                    {
                        id: 'content-strategist', icon: 'calendar', name: '30-Day Calendar',
                        desc: 'Kalender konten seimbang: Edukasi, Engagement, dan Sales.',
                        inputs: [{ id: 'niche_c', label: 'Niche Bisnis', placeholder: 'e.g. Kedai Kopi Kekinian' }],
                        prompt: (data) => `Buat kalender konten 30 hari untuk "${data.niche_c}" lengkap (Edukasi, Sales, Engagement).`
                    },
                    {
                        id: 'script-pro', icon: 'film', name: 'Script Architect',
                        desc: 'Naskah video vertikal cinematic dengan hook mematikan.',
                        inputs: [
                            { id: 's_topic', label: 'Topik Video', placeholder: 'e.g. 3 Rahasia Sukses Bisnis' },
                            { id: 's_aura', label: 'Aura Visual (Vibe 2026)', type: 'select', options: [
                                'Mewah, Gelap & Misterius (Dark Luxury)', 'Masa Depan / Cyber-Punk 2026', 'Estetik Bersih & Minimalis',
                                'Sinematik Hiper-Realis', 'Nostalgia VHS / Jadul (Vintage)', 'Old Money Luxury (Elegan Klasik)'
                            ]}
                        ],
                        prompt: (data) => `Buat script video vertikal tentang "${data.s_topic}" dengan aura visual "${data.s_aura}".`
                    },
                    {
                        id: 'voice-pro', icon: 'mic-2', name: 'Voice Transmuter',
                        desc: 'Ubah teks kaku menjadi magnet audiens dengan LuxuryCore.',
                        inputs: [
                            { id: 'v_raw', label: 'Teks Sumber', type: 'textarea', placeholder: 'Tempel caption kaku Anda di sini...' },
                            { id: 'v_aura', label: 'Tone Suara / Persona', type: 'select', options: [
                                'Alfa Dominan (Tegas)', 'Mewah Senyap (Elegan)', 'Intelek Cerdas (Tajam)', 
                                'Gaya Jalanan (Hype)', 'Mentor Empatik (Bijak)', 'Bold Rebel (Berani)'
                            ]}
                        ],
                        prompt: (data) => `Rewrite teks: "${data.v_raw}" dengan persona "${data.v_aura}". Jadikan sangat berbobot.`
                    },
                    {
                        id: 'design-brief', icon: 'palette', name: 'Canva Design Brief',
                        desc: 'Instruksi visual agar desain terlihat premium.',
                        inputs: [{ id: 'd_topic', label: 'Topik Seri Konten', placeholder: 'e.g. 10 Tips Investasi Saham' }],
                        prompt: (data) => `Buat design brief 10 slide Instagram tentang "${data.d_topic}".`
                    }
                ]
            },
            {
                name: "Algorithm Hack",
                tools: [
                    {
                        id: 'hook-gen', icon: 'zap', name: 'Viral Hooks',
                        desc: '15 Attention-Grabber yang menghentikan scroll.',
                        inputs: [{ id: 'h_topic', label: 'Subjek Hook', placeholder: 'e.g. Cara Turun BB Tanpa Lapar' }],
                        prompt: (data) => `Buat 15 hook viral untuk "${data.h_topic}".`
                    },
                    {
                        id: 'hashtag-master', icon: 'hash', name: 'Hashtag Architect',
                        desc: 'Koordinat hashtag untuk jangkauan viral.',
                        inputs: [{ id: 'n_h', label: 'Niche', placeholder: 'e.g. Wellness Lifestyle' }],
                        prompt: (data) => `Generate 20 hashtag viral untuk niche "${data.n_h}".`
                    },
                    {
                        id: 'seo-nav', icon: 'navigation', name: 'SEO Navigator',
                        desc: 'Ranking #1 di Instagram/TikTok search.',
                        inputs: [{ id: 'kw', label: 'Kata Kunci Target', placeholder: 'e.g. Tutorial Bisnis Online' }],
                        prompt: (data) => `Berikan strategi SEO Social untuk keywords "${data.kw}".`
                    },
                    {
                        id: 'scheduling', icon: 'clock', name: 'Golden Schedule',
                        desc: 'Jadwal posting optimasi Golden Hour 2026.',
                        inputs: [
                            { id: 'reg', label: 'Wilayah Target', placeholder: 'e.g. Jakarta (WIB)' },
                            { id: 'v_freq', label: 'Intensitas Posting', type: 'select', options: [
                                'Konsisten (1x Sehari)', 'Agresif (3x Sehari)', 'Mengejar Momentum Viral', 'Fokus Akhir Pekan'
                            ]}
                        ],
                        prompt: (data) => `Rancang jadwal posting harian di "${data.reg}" dengan intensitas "${data.v_freq}".`
                    }
                ]
            },
            {
                name: "Growth Mastery",
                tools: [
                    {
                        id: 'perf-audit', icon: 'bar-chart-2', name: 'Deep Audit',
                        desc: 'Bedah autopsi konten & temukan kebocoran engagement.',
                        inputs: [{ id: 'a_data', label: 'Data Konten', type: 'textarea', placeholder: 'Paste stats atau caption terakhir...' }],
                        prompt: (data) => `Lakukan audit 'Super Daging' pada data: "${data.a_data}".`
                    },
                    {
                        id: 'psych-trigger', icon: 'brain', name: 'Psychology Lab',
                        desc: 'Suntikkan bias kognitif untuk konversi instan.',
                        inputs: [
                            { id: 'p_base', label: 'Ide Konten', type: 'textarea', placeholder: 'e.g. Promo diskon 50% untuk 10 orang' },
                            { id: 'p_type', label: 'Trigger Utama', type: 'select', options: [
                                'FOMO (Takut Ketinggalan)', 'Otoritas (Keahlian Ahli)', 'Kelangkaan (Terbatas)', 'Social Proof (Bukti Sosial)', 'Celah Penasaran (Curiosity Gap)'
                            ]}
                        ],
                        prompt: (data) => `Suntikkan trigger "${data.p_type}" ke dalam konten: "${data.p_base}".`
                    },
                    {
                        id: 'crisis-mgmt', icon: 'alert-triangle', name: 'Crisis Control',
                        desc: 'Selamatkan reputasi brand dari krisis.',
                        inputs: [{ id: 'crisis_p', label: 'Masalah (Skenario)', type: 'textarea', placeholder: 'e.g. Influencer @travel_master komplain layanan kita buruk di Reels. Postingan dia viral dengan 10rb share dalam 3 jam, sentimen mulai negatif.' }],
                        prompt: (data) => `Berikan strategi menangani krisis: "${data.crisis_p}".`
                    },
                    {
                        id: 'cult-builder', icon: 'users', name: 'Community Cult',
                        desc: 'Ubah followers menjadi loyalis fanatik.',
                        inputs: [{ id: 'ess', label: 'Brand Essence', placeholder: 'e.g. Pemberdayaan Wanita Karir' }],
                        prompt: (data) => `Rancang strategi membangun komunitas 'Cult-like' bagi "${data.ess}".`
                    }
                ]
            }
        ];

        const allTools = toolCategories.flatMap(cat => cat.tools);
        let currentToolId = allTools[0].id;

        function getDeviceSignature() {
            return btoa(navigator.userAgent.replace(/\d+/g, '') + screen.width + screen.height);
        }

        // AUTH & DEVICE GUARD
        const loginForm = document.getElementById('login-form');
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-login-submit');
            btn.disabled = true; btn.innerText = "Memproses...";
            try {
                await setPersistence(auth, browserSessionPersistence);
                const userCredential = await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value);
                const user = userCredential.user;
                const sig = getDeviceSignature();
                const ref = doc(db, 'artifacts', systemId, 'users', user.uid, 'security', 'device_lock');
                const snap = await getDoc(ref);

                if (snap.exists()) {
                    if (snap.data().signature !== sig) {
                        await signOut(auth);
                        throw new Error("Akun terikat ke perangkat lain.");
                    }
                } else {
                    await setDoc(ref, { signature: sig, boundAt: new Date().toISOString() });
                }
            } catch (err) {
                document.getElementById('login-error').innerText = err.message.includes("terikat") ? err.message : "Email/Password salah.";
                document.getElementById('login-error').classList.remove('hidden-element');
                btn.disabled = false; btn.innerText = "Otorisasi Masuk";
            }
        };

        window.handleLogout = () => { window.geminiApiKey = ""; signOut(auth); location.reload(); };
        window.toggleTutorial = () => document.getElementById('api-tutorial').classList.toggle('hidden-element');

        window.validateApiKey = async () => {
            const key = document.getElementById('input-api-key').value.trim();
            if (!key) return;
            const btn = document.getElementById('btn-validate-key');
            btn.disabled = true; btn.innerText = "Validasi...";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "hi" }] }] })
                });
                if (response.ok) {
                    window.geminiApiKey = key;
                    document.getElementById('api-activation-screen').classList.add('hidden-element');
                    document.getElementById('main-wrapper').classList.remove('hidden-element');
                    initApp();
                } else throw new Error();
            } catch {
                window.showNotif("API Key Tidak Valid.", true);
                btn.disabled = false; btn.innerText = "Aktifkan Intelligence Suite";
            }
        };

        window.clearApiKey = () => { window.geminiApiKey = ""; location.reload(); };

        onAuthStateChanged(auth, (user) => {
            document.getElementById('neural-preloader').style.opacity = '0';
            setTimeout(() => document.getElementById('neural-preloader').style.display = 'none', 500);
            if (user) {
                document.getElementById('login-screen').classList.add('hidden-element');
                if (!window.geminiApiKey) document.getElementById('api-activation-screen').classList.remove('hidden-element');
                else { document.getElementById('main-wrapper').classList.remove('hidden-element'); initApp(); }
            } else {
                document.getElementById('login-screen').classList.remove('hidden-element');
                document.getElementById('main-wrapper').classList.add('hidden-element');
            }
        });

        // DASHBOARD CORE
        function initApp() {
            const nav = document.getElementById('sidebar-nav'); nav.innerHTML = '';
            toolCategories.forEach(cat => {
                const t = document.createElement('div'); t.className = 'text-[9px] font-black text-zinc-600 uppercase tracking-[0.3em] mb-3 mt-8 px-5';
                t.innerText = cat.name; nav.appendChild(t);
                cat.tools.forEach(tool => {
                    const btn = document.createElement('button');
                    btn.className = `nav-item w-full flex items-center gap-4 px-5 py-3.5 text-[13px] text-zinc-400 group transition-all rounded-lg mb-1`;
                    btn.id = `nav-${tool.id}`; btn.onclick = () => selectTool(tool.id);
                    btn.innerHTML = `<i data-lucide="${tool.icon}" class="w-4 h-4"></i><span class="font-bold">${tool.name}</span>`;
                    nav.appendChild(btn);
                });
            });
            if (currentToolId) selectTool(currentToolId);
        }

        function selectTool(id) {
            currentToolId = id; const tool = allTools.find(t => t.id === id);
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if (document.getElementById(`nav-${id}`)) document.getElementById(`nav-${id}`).classList.add('active');
            document.getElementById('active-tool-title').innerText = tool.name;
            document.getElementById('result-container').classList.add('hidden-element');
            document.getElementById('tool-interface').innerHTML = `
                <div class="mb-10"><h2 class="luxury-font text-3xl text-white mb-2 italic font-bold tracking-tight">${tool.name}</h2><p class="text-zinc-300 text-sm opacity-90">${tool.desc}</p></div>
                <div class="space-y-8">${tool.inputs.map(input => `<div class="group"><label class="block text-[11px] font-bold text-white uppercase tracking-[0.4em] mb-3">${input.label}</label>${input.type === 'textarea' ? `<textarea id="${input.id}" placeholder="${input.placeholder}" class="p-6 rounded-xl h-44 transition-all"></textarea>` : input.type === 'select' ? `<select id="${input.id}" class="p-6 rounded-xl appearance-none cursor-pointer">${input.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select>` : `<input type="text" id="${input.id}" placeholder="${input.placeholder}" class="p-6 rounded-xl transition-all">`}</div>`).join('')}
                <button onclick="window.executeAI()" id="generate-btn" class="neural-btn w-full py-7 rounded-2xl flex items-center justify-center gap-6 text-sm"><span>Deploy Strategic Command</span><i data-lucide="zap" class="w-5 h-5"></i></button></div>`;
            if (window.lucide) window.lucide.createIcons();
            document.getElementById('main-scroll-area').scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.executeAI = async () => {
            if (isLoadingAI) return; const tool = allTools.find(t => t.id === currentToolId);
            const data = {}; let valid = true;
            tool.inputs.forEach(input => { const el = document.getElementById(input.id); if (!el || !el.value.trim()) valid = false; else data[input.id] = el.value.trim(); });
            if (!valid) return window.showNotif("Input Data Belum Lengkap.", true);

            isLoadingAI = true; const btn = document.getElementById('generate-btn'); btn.disabled = true; btn.innerHTML = `MENGANALISA...`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${window.geminiApiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: tool.prompt(data) }] }],
                        systemInstruction: { parts: [{ text: "Kamu adalah Supreme Social Media Intelligence 2026. ANALISIS: Tajam. SOLUSI: Super Daging. GAYA: LuxuryCore 2026. FORMAT: Markdown rapi, Teks Justified (Rata Kiri Kanan)." }] }
                    })
                });
                const res = await response.json(); const output = res.candidates?.[0]?.content?.parts?.[0]?.text;
                if (output) {
                    document.getElementById('result-content').innerHTML = window.marked.parse(output);
                    document.getElementById('result-container').classList.remove('hidden-element');
                    document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
                } else throw new Error();
            } catch { window.showNotif("Neural Sync Gagal.", true); }
            finally { isLoadingAI = false; btn.disabled = false; btn.innerHTML = `<span>Deploy Strategic Command</span><i data-lucide="zap" class="w-5 h-5"></i>`; if (window.lucide) window.lucide.createIcons(); }
        };

        window.copyResult = () => {
            const t = document.getElementById('result-content').innerText; const el = document.createElement('textarea');
            el.value = t; document.body.appendChild(el); el.select(); document.execCommand('copy');
            document.body.removeChild(el); window.showNotif("Strategi Tersalin.");
        };

        window.exportToWord = () => {
            const content = document.getElementById('result-content').innerHTML.replace(/<code>|<\/code>/g, '');
            const toolName = document.getElementById('active-tool-title').innerText;
            const header = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><style>@page { size: 21cm 29.7cm; margin: 2.5cm; } body { font-family: 'Calibri', sans-serif; color: #1a1a1a; } p, li { text-align: justify; line-height: 1.6; margin-bottom: 12pt; font-size: 11pt; } h1 { color: #D4AF37; text-align: center; border-bottom: 2px solid #D4AF37; padding-bottom: 10px; font-size: 24pt; } h2 { color: #333; margin-top: 20pt; border-bottom: 1px solid #eee; } table { border-collapse: collapse; width: 100%; margin: 15pt 0; } th { background-color: #f2f2f2; border: 1px solid #999; padding: 8pt; font-weight: bold; } td { border: 1px solid #999; padding: 8pt; vertical-align: top; }</style></head><body><h1>SOCIAL MEDIA SPECIALIST</h1><h2>${toolName.toUpperCase()}</h2>${content}</body></html>`;
            const blob = new Blob(['\ufeff', header], { type: 'application/msword' });
            const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `Strategi_${toolName.replace(/\s+/g, '_')}.doc`;
            link.click(); window.showNotif("Simpan Word Berhasil.");
        };

        window.showNotif = (m, e = false) => {
            const n = document.getElementById('notification'); document.getElementById('notification-text').innerText = m;
            n.classList.remove('translate-y-40', 'opacity-0'); n.classList.add('translate-y-0', 'opacity-100');
            if (e) n.classList.add('border-red-500/50'); else n.classList.remove('border-red-500/50');
            setTimeout(() => { n.classList.add('translate-y-40', 'opacity-0'); }, 4000);
        };

        document.addEventListener('DOMContentLoaded', () => { if (window.lucide) window.lucide.createIcons(); });
    </script>
</body>
</html>
